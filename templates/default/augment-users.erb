#!/usr/bin/env bash
# Dropped off by Chef recipe users-augment::default

main() {
  local GREEN=$(echo -e "\033[32;1m")
  local RED=$(echo -e "\033[31;1m")
  local RESET=$(echo -e "\033[0m")
  local YELLOW=$(echo -e "\033[33;1m")

<% if @info.nil? -%>
  echo "${YELLOW}Move along human, nothing to augment here.${RESET}"
<% else -%>
  <% @info.each_pair do |un, data| -%>
  grep -q "<%= data[:keys] %>" "<%= data[:authorized_keys_path] %>" || \
    echo -e "<%= data[:keys] %>" >> \
    "<%= data[:authorized_keys_path] %>"

  <% end -%>
  echo "${GREEN}Users augmented. You're welcome, human.${RESET}"
<% end -%>
}

set -e
main "$@"
